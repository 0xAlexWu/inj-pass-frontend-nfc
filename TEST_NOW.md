# 🚀 立即测试 Pumex Swap 功能

Router 地址已配置完成！现在可以开始测试了。

## ⚡ 快速测试（5分钟）

### 步骤 1: 安装依赖

```bash
cd frontend
pnpm install
```

### 步骤 2: 验证配置（可选但推荐）

```bash
pnpm find-router
```

**✅ 成功的输出应该包含**:
```
✅ This IS a contract
✅ Found WETH() method → Returns: 0x0000000088827d2d103ee2d9A6b781773AE03FfB
✅ Found factory() method
✅ Successfully got quote for INJ -> USDT swap!
```

**❌ 如果看到错误**:
- 检查网络连接
- 确认 RPC 可访问
- 稍后重试

### 步骤 3: 启动开发服务器

```bash
pnpm dev
```

服务器会在 http://localhost:3000 启动

### 步骤 4: 访问 Swap 页面

在浏览器打开：
```
http://localhost:3000/swap
```

### 步骤 5: 解锁钱包

1. 点击解锁按钮
2. 使用 Passkey 认证
3. 等待钱包解锁

### 步骤 6: 测试报价功能

**测试 INJ → USDC**:
```
1. From: INJ
2. To: USDC
3. 输入: 0.01
4. 等待 1-2 秒
5. ✅ 应该显示预估输出（约 0.031 USDC）
```

**测试 INJ → USDT**:
```
1. From: INJ
2. To: USDT
3. 输入: 0.01
4. ✅ 应该显示预估输出
```

**测试 USDC → USDT**:
```
1. From: USDC
2. To: USDT
3. 输入: 1.0
4. ✅ 应该显示预估输出（约 1:1）
```

## 🧪 完整测试（15分钟）

### 测试 1: 查看余额

**预期**:
- ✅ INJ 余额显示（例如 1.234 INJ）
- ✅ USDT 余额显示（如果有）
- ✅ USDC 余额显示（如果有）

**如果余额不显示**:
- 等待几秒（可能在加载）
- 刷新页面
- 检查钱包是否有该 token

### 测试 2: 报价加载

**测试场景**:
```
输入 0.1 INJ → USDT
```

**预期行为**:
1. ⏳ 输入后 500ms 开始加载
2. 🔄 显示 "Loading..." 或加载动画
3. ✅ 显示预估输出（约 0.31 USDT）
4. 📊 显示价格影响（< 1%）
5. ⚡ 显示 gas 估算

**如果报价失败**:
- 查看浏览器控制台（F12）
- 检查错误信息
- 参考 `ROUTER_CONFIGURED.md` 的故障排查部分

### 测试 3: 执行 Swap（小额）

**准备**:
- ✅ 确保有至少 0.02 INJ（0.01 用于 swap，0.01 用于 gas）
- ✅ 钱包已解锁
- ✅ 报价已成功加载

**执行步骤**:
```
1. From: INJ
2. To: USDC
3. 金额: 0.01 INJ
4. 确认报价合理
5. 点击 "Swap Tokens"
6. 等待授权（如果需要）
7. 等待交易确认
8. ✅ 看到成功提示和交易哈希
```

**预期结果**:
- ✅ 成功提示弹出
- ✅ 显示交易哈希
- ✅ 余额自动更新
- ✅ 在区块浏览器可以查看交易

**交易时间**:
- 授权（如需要）: 5-10 秒
- Swap 执行: 5-10 秒
- 总计: ~15 秒

### 测试 4: 验证交易

**复制交易哈希**，然后访问：
```
https://blockscout.injective.network/tx/你的交易哈希
```

**检查**:
- ✅ 状态: Success
- ✅ From: 你的地址
- ✅ To: RouterV2 (0xC724...2bE1)
- ✅ Token transfers 显示正确

### 测试 5: Token 授权流程

如果是第一次 swap ERC20 token（USDT 或 USDC）:

**预期流程**:
```
1. 点击 Swap
2. 🔄 检测到需要授权
3. 📝 自动发起授权交易
4. ⏳ 等待授权确认（5-10秒）
5. ✅ 授权完成
6. 🔄 自动继续执行 swap
7. ⏳ 等待 swap 确认
8. ✅ 完成！
```

**注意**: 授权只需要一次，之后的 swap 不需要重复授权。

## 📊 测试清单

### 基础功能
- [ ] 页面加载正常
- [ ] 钱包解锁成功
- [ ] 余额显示正确
- [ ] Token 选择器工作
- [ ] 可以切换 From/To token

### 报价功能
- [ ] INJ → USDC 报价成功
- [ ] INJ → USDT 报价成功
- [ ] USDC → USDT 报价成功
- [ ] 报价在输入变化时更新
- [ ] 价格影响显示合理
- [ ] 滑点可以调整

### Swap 功能
- [ ] 小额 swap 成功（0.01 INJ）
- [ ] Token 授权自动处理
- [ ] 交易确认提示清晰
- [ ] 交易哈希可复制
- [ ] 余额自动刷新

### 错误处理
- [ ] 余额不足时有提示
- [ ] 网络错误时有提示
- [ ] 授权失败时有提示
- [ ] 交易失败时有提示

### 用户体验
- [ ] 加载状态清晰
- [ ] 按钮禁用状态正确
- [ ] 错误消息友好
- [ ] 可以关闭错误提示
- [ ] 交易后自动清空输入

## 🐛 常见问题

### Q: 报价一直显示 "Loading..."

**原因**: 
- RPC 延迟
- 交易对没有流动性
- 网络问题

**解决**:
1. 等待 5 秒
2. 刷新页面重试
3. 检查浏览器控制台错误
4. 运行 `pnpm find-router` 验证配置

### Q: Swap 按钮一直禁用

**原因**:
- 没有输入金额
- 报价未加载成功
- 钱包未解锁

**解决**:
1. 确认已输入金额
2. 等待报价加载
3. 确认钱包已解锁

### Q: 交易失败

**原因**:
- 余额不足
- Gas 不够
- 滑点太低
- 授权失败

**解决**:
1. 检查余额（需要额外的 INJ 支付 gas）
2. 增加滑点到 1%
3. 查看交易详情了解具体错误
4. 刷新页面重试

### Q: 余额不更新

**原因**:
- 交易未确认
- 页面缓存

**解决**:
1. 等待 10-20 秒
2. 刷新页面
3. 检查交易是否成功确认

## 📱 测试场景

### 场景 1: 新用户首次 Swap
```
1. 访问页面 → ✅ 看到 Swap 界面
2. 尝试 swap → ❌ 提示需要解锁
3. 解锁钱包 → ✅ 显示余额
4. 输入金额 → ✅ 显示报价
5. 执行 swap → ⏳ 自动处理授权
6. 等待确认 → ✅ 成功！
```

### 场景 2: 有经验用户快速 Swap
```
1. 访问页面 → ✅ 已解锁
2. 输入 0.05 INJ → ✅ 立即显示报价
3. 点击 Swap → ✅ 直接执行（无需授权）
4. 5 秒后 → ✅ 完成
```

### 场景 3: 大额 Swap
```
1. 输入 10 INJ → ✅ 显示报价
2. 检查价格影响 → ⚠️ 可能较高
3. 调整滑点到 1% → ✅
4. 执行 swap → ✅ 成功
```

## 🎯 成功标准

如果满足以下条件，说明集成成功：

✅ **报价系统**:
- 输入金额后 2 秒内显示报价
- 报价合理（可以与 Pumex dApp 对比）
- 更换 token 时报价正确更新

✅ **Swap 执行**:
- 小额测试成功（0.01 INJ）
- 交易在区块浏览器可见
- 余额正确更新

✅ **用户体验**:
- 界面流畅无卡顿
- 错误提示清晰
- 加载状态明确

✅ **所有交易对**:
- INJ → USDC ✅
- INJ → USDT ✅
- USDC → USDT ✅

## 🚀 开始测试

```bash
# 1. 进入项目
cd /Users/dongfang/Desktop/injpass-nfc/frontend

# 2. 安装依赖
pnpm install

# 3. 验证配置
pnpm find-router

# 4. 启动
pnpm dev

# 5. 测试
# 访问 http://localhost:3000/swap
```

## 📞 需要帮助？

- 💬 查看完整文档: `ROUTER_CONFIGURED.md`
- 🐛 故障排查: 查看浏览器控制台（F12）
- 📖 使用指南: `README_SWAP.md`

---

**准备好了吗？开始测试吧！** 🎉
